name: 'Setup Nix S3 Cache'
description: 'Configure Nix to use an S3-backed cache with post-build hook for uploading'
inputs:
  s3-endpoint:
    description: 'S3 endpoint URL (e.g., https://s3.amazonaws.com or https://account.r2.cloudflarestorage.com)'
    required: true
  bucket:
    description: 'S3 bucket name for the cache'
    required: true
  public-key:
    description: 'Public key for the cache'
    required: true
  private-key:
    description: 'Private key for signing uploads (optional, if not provided, no signing)'
    required: false
  aws-access-key-id:
    description: 'AWS access key ID (optional, uses AWS_ACCESS_KEY_ID env if not provided)'
    required: false
  aws-secret-access-key:
    description: 'AWS secret access key (optional, uses AWS_SECRET_ACCESS_KEY env if not provided)'
    required: false
  region:
    description: 'AWS region (optional, uses AWS_DEFAULT_REGION or AWS_REGION env if not provided)'
    required: false
  create-bucket:
    description: 'Create the S3 bucket if it does not exist (default: false)'
    required: false
runs:
  using: 'composite'
   steps:
    - name: Configure Nix for S3 cache
      shell: bash
      run: 'bash $GITHUB_ACTION_PATH/setup.sh --s3-endpoint ${{ inputs.s3-endpoint }} --bucket ${{ inputs.bucket }} --public-key ${{ inputs.public-key }} --private-key ${{ inputs.private-key }} --aws-access-key-id ${{ inputs.aws-access-key-id }} --aws-secret-access-key ${{ inputs.aws-secret-access-key }} --region ${{ inputs.region }} --create-bucket ${{ inputs.create-bucket }}'
